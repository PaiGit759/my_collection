<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

  <body class="home">
    <%- include('./partials/nav.ejs') %>

      <div class="container py-5">
        <div class="row justify-content-center">
          <div class="col-lg-8 col-md-10">
            <!-- <div class="text-center mb-4">
              <h2>Title</h2>
              <p>
                <%= collection.title %>
              </p>
            </div> -->


            <div class="row mb-4">

              <div class="col-12 col-md-6 mb-3">
                <div class="d-flex align-items-center">
                  <span class="fw-bold me-2">Title:</span>
                  <span class="flex-grow-1 form-control bg-light">
                    <%= collection.title %>
                  </span>
                </div>
              </div>

              <div class="col-12 col-md-6 mb-3">
                <div class="d-flex align-items-center">
                  <span class="fw-bold me-2">Group:</span>
                  <span class="flex-grow-1 form-control bg-light">
                    <%= collection.group %>
                  </span>
                </div>
              </div>



            </div>




            <div class="text-center mb-4">
              <h4>Content</h4>
              <textarea class="form-control" rows="8"><%= collection.content %></textarea>
            </div>

            <div class="row text-center">
              <div class="col-12 col-md-4 mb-3">
                <h5>Foto</h5> <img src="/image/<%= collection.foto %>" class="gallery-img">
              </div>
              <div class="col-12 col-md-4 mb-3">
                <h5>Foto1</h5> <img src="/image/<%= collection.foto1 %>" class="gallery-img">
              </div>
              <div class="col-12 col-md-4 mb-3">
                <h5>Foto2</h5> <img src="/image/<%= collection.foto2 %>" class="gallery-img">
              </div>
            </div>


            <!-- class="gallery-img" class="img-fluid rounded" -->

            <div class="d-flex align-items-center justify-content-center flex-wrap">
              <% if (userowner) { %>
                <h5 class="me-3 mb-0">
                  Owner
                  <b>
                    <%= userowner.firstName || '' %>
                      <%= userowner.lastName || '' %>
                  </b>
                  ( <%= userowner.email || '' %>)
                </h5>

                <% if (userowner.foto) { %>
                  <img src="/user/foto/<%= userowner.foto %>" class="img-fluid rounded"
                    style="max-width:100px; height:auto;">
                  <% } %>
                    <% } else { %>
                      <h5 class="mb-0">Owner: Unknown</h5>
                      <% } %>
            </div>

          </div>
        </div>
        <!-- 
        <div class="text-center my-4">
          <button class="btn btn-success" onclick="goToIndex()">Return</button>
        </div>

        <div id="actionButtons" class="text-center my-4"></div> -->

        <div class="d-flex justify-content-center gap-3 flex-wrap my-4">
          <button class="btn btn-success" onclick="goToIndex()">Return</button>
          <div id="actionButtons"></div>
        </div>



      </div>

      <input type="hidden" id="collection_id" value="<%= collection.id %>">

      <%- include('./partials/footer.ejs') %>

        <style>
          .home {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 12px;
            background-color: #cfe7ed;
            color: black;
            padding-top: 0;
          }

          .userfoto {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ccc;
          }

          .gallery-img {
            width: 100%;
            height: 350px;
            /* можно 180–250px */
            object-fit: cover;
            border-radius: 8px;
          }
        </style>

        <style>
          .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
          }
        </style>


        <script>
          // Go to the home page with the saved page
          function goToIndex() {
            const page = localStorage.getItem('galleryPage') || 1;
            localStorage.removeItem('galleryPage');
            window.location.href = `/?page=${page}`;
          }

        </script>

        <script src="/js/userfoto.js"></script>


        <script src="/js/gallery.js"></script>

        <script>

          const creatorId = '<%= collection.user ? collection.user._id : "" %>';
          const collectionId = '<%= collection._id %>';


          if (user && (user.role === 'admin' || user._id === creatorId)) {

            const container = document.getElementById('actionButtons');

            const editBtn = document.createElement('button');
            editBtn.className = 'btn btn-primary me-2';
            editBtn.textContent = 'Edit';
            editBtn.id = "edit-btn";

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn btn-danger';
            deleteBtn.textContent = 'Delete';
            deleteBtn.id = "delete-btn";

            container.appendChild(editBtn);
            container.appendChild(deleteBtn);

            editBtn.addEventListener('click', function () {
              document.getElementById('spinner').style.display = 'flex';
              window.location.href = `/editcollection?id=${collection_id.value}`;
            });

            deleteBtn.addEventListener('click', function () {
              const page = localStorage.getItem('galleryPage') || 1;
              const isConfirmed = confirm('Are you sure you want to delete the collection?');

              if (isConfirmed) {
                document.getElementById('spinner').style.display = 'flex';
                window.location.href = `/deletecollection?id=${collectionId}&page=${page}`;
              } else {
                alert('Deletion cancelled by user');
              }
            });
          }

        </script>

        <script>
          window.onload = function () {
            const spinner = document.getElementById('page-spinner');
            if (spinner) spinner.style.display = 'none';
          };
        </script>

        <div id="spinner" class="spinner-overlay" style="display:none;">
          <div class="spinner-border text-primary" role="status"></div>
        </div>


  </body>

</html>