–¢–ó

–µ—Å—Ç—å html

<!DOCTYPE html>
<html lang="en">

<%- include('./partials/head.ejs') %>


  <body>

    <%- include('./partials/nav.ejs') %>

      <div class="container container_vid1 py-4">
        <div id="gallery" class="row g-3"></div>

        <nav class="d-flex justify-content-center mt-4">
          <ul class="pagination" id="pagination" style="margin-bottom: 40px ;"></ul>
        </nav>
      </div>

      <%- include('./partials/footer.ejs') %>

        <script src="/js/bootstrap.bundle.min.js"></script>
        <script src="/js/gallery.js"></script>


        //
        <script src="/js/userfoto.js"></script>

  </body>

</html>

–µ—Å—Ç—å gallery.js

const objects = Array.from({ length: 160 }, (_, i) => ({
    title: `–û–±—ä–µ–∫—Ç ${i + 1}`,
    //           img: `https://via.placeholder.com/150?text=${i + 1}`,
    img: `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
}));


const itemsPerPage = 18;
const pagesPerGroup = 5;
let currentPage = 1;

function renderGallery(page) {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageItems = objects.slice(start, end);

    pageItems.forEach((obj) => {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-md-3 col-lg-2";

        col.innerHTML = `
  <div class="card h-100">
    <img src="${obj.img}" class="card-img-top" alt="${obj.title}" />
    <div class="card-body text-center">
      <h6 class="card-title">${obj.title}</h6>
      <button class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
    </div>
  </div>
`;
        gallery.appendChild(col);
    });
}

function renderPagination() {
    const totalPages = Math.ceil(objects.length / itemsPerPage);
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = "";

    const groupIndex = Math.floor((currentPage - 1) / pagesPerGroup);
    const start = groupIndex * pagesPerGroup + 1;
    const end = Math.min(start + pagesPerGroup - 1, totalPages);

    // << –ö –Ω–∞—á–∞–ª—É
    pagination.appendChild(createPageItem("<<", 1, currentPage === 1));

    // < –ù–∞–∑–∞–¥ –Ω–∞ 5
    pagination.appendChild(createPageItem("<", start - 1, start === 1));

    // –°—Ç—Ä–∞–Ω–∏—Ü—ã –≥—Ä—É–ø–ø—ã
    for (let i = start; i <= end; i++) {
        const li = createPageItem(i, i, false, i === currentPage);
        pagination.appendChild(li);
    }

    // > –í–ø–µ—Ä–µ–¥ –Ω–∞ 5
    pagination.appendChild(createPageItem(">", end + 1, end === totalPages));

    // >> –í –∫–æ–Ω–µ—Ü
    pagination.appendChild(createPageItem(">>", totalPages, currentPage === totalPages));
}

function createPageItem(label, page, disabled, active = false) {
    const li = document.createElement("li");
    li.className = `page-item ${disabled ? "disabled" : ""}`;
    //   li.style = 'margin: 30px';
    const btn = document.createElement("button");
    btn.className = `page-link page-btn ${active ? "active" : ""}`;

    btn.textContent = label;
    btn.onclick = () => {
        if (!disabled) {
            currentPage = page;
            renderGallery(currentPage);
            renderPagination();
        }
    };
    li.appendChild(btn);
    return li;
}

// –ü–µ—Ä–≤–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
renderGallery(currentPage);
renderPagination();

–∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–æ–¥–∏—Ç –≥–∞–ª–µ—Ä–µ—é –∏–∑ –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ objects

–ó–∞–¥–∞—á–∞ –∑–∞–º–µ–Ω–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–Ω–æ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤,
–ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ú–æ–Ω–≥–æ –î–ë.
–ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ–±—Ö–µ–∫—Ç–æ–≤ –º–µ–Ω—å—à–µ —á–µ–º 160, —Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∏—Ö —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∫–∞–∫ –≤—ã—à–µ.

–ß—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ objects –Ω–∞ –º–∞—Å—Å–∏–≤, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ MongoDB, –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –¥–æ 160 —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî —Ç–µ–±–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:

üì¶ –°–æ–∑–¥–∞—Ç—å API –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ MongoDB.

üåê –ó–∞–ø—Ä–æ—Å–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —á–µ—Ä–µ–∑ fetch.

üß† –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏, –µ—Å–ª–∏ –∏—Ö –º–µ–Ω—å—à–µ 160.

üñºÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≥–∞–ª–µ—Ä–µ–∏.

–®–∞–≥ 1: –°–µ—Ä–≤–µ—Ä–Ω—ã–π API (Node.js + Express)
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–∞ Express. –î–æ–±–∞–≤—å –º–∞—Ä—à—Ä—É—Ç:

// routes/gallery.js
const express = require('express');
const router = express.Router();
const { MongoClient } = require('mongodb');

const uri = 'mongodb://localhost:27017'; // –∏–ª–∏ —Ç–≤–æ–π URI
const dbName = 'yourDatabase';
const collectionName = 'yourCollection';

router.get('/api/gallery', async (req, res) => {
  try {
    const client = new MongoClient(uri);
    await client.connect();
    const db = client.db(dbName);
    const collection = db.collection(collectionName);

    const items = await collection.find({}).toArray();
    res.json(items);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö' });
  }
});

module.exports = router;

–ò –ø–æ–¥–∫–ª—é—á–∏ –µ–≥–æ –≤ app.js:

const galleryRoutes = require('./routes/gallery');
app.use(galleryRoutes);

–®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ gallery.js –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

–ó–∞–º–µ–Ω–∏–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∏–≤ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π:

let objects = [];
const itemsPerPage = 18;
const pagesPerGroup = 5;
let currentPage = 1;

async function fetchGalleryData() {
  try {
    const res = await fetch('/api/gallery');
    const data = await res.json();

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    const dbObjects = data.map((item, i) => ({
      title: item.title || `–û–±—ä–µ–∫—Ç ${i + 1}`,
      img: item.img || `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
    }));

    // –î–æ–ø–æ–ª–Ω—è–µ–º –¥–æ 160
    const generatedCount = 160 - dbObjects.length;
    const generatedObjects = Array.from({ length: generatedCount }, (_, i) => ({
      title: `–û–±—ä–µ–∫—Ç ${dbObjects.length + i + 1}`,
      img: `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
    }));

    objects = [...dbObjects, ...generatedObjects];

    renderGallery(currentPage);
    renderPagination();
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏:', err);
  }
}

// –ó–∞–ø—É—Å–∫
fetchGalleryData();

–†–µ–∑—É–ª—å—Ç–∞—Ç
–¢–µ–ø–µ—Ä—å —Ç–≤–æ—è –≥–∞–ª–µ—Ä–µ—è:

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ MongoDB.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –¥–æ 160 –æ–±—ä–µ–∫—Ç–æ–≤.

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ö —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.


–µ—Å—Ç—å html

<!DOCTYPE html>
<html lang="en">

<%- include('./partials/head.ejs') %>


  <body>

    <%- include('./partials/nav.ejs') %>

      <div class="container container_vid1 py-4">
        <div id="gallery" class="row g-3"></div>

        <nav class="d-flex justify-content-center mt-4">
          <ul class="pagination" id="pagination" style="margin-bottom: 40px ;"></ul>
        </nav>
      </div>

      <%- include('./partials/footer.ejs') %>

        <script src="/js/bootstrap.bundle.min.js"></script>
        <script src="/js/gallery.js"></script>


        //
        <script src="/js/userfoto.js"></script>

  </body>

</html>

–µ—Å—Ç—å gallery.js

let objects = [];
async function fetchGalleryData() {
    try {
        const res = await fetch('/gallery');
        const data = await res.json();
        //        console.log('!!!!!!!!!', res);
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        const dbObjects = data.map((item, i) => ({
            title: item.title || `–û–±—ä–µ–∫—Ç ${i + 1}`,
            img: item.foto || `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
        }));

        // –î–æ–ø–æ–ª–Ω—è–µ–º –¥–æ 160
        // const generatedCount = 160 - dbObjects.length;
        // const generatedObjects = Array.from({ length: generatedCount }, (_, i) => ({
        //     title: `–û–±—ä–µ–∫—Ç ${dbObjects.length + i + 1}`,
        //     img: `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
        // }));

        //   objects = [...dbObjects, ...generatedObjects];
        objects = [...dbObjects];


        renderGallery(currentPage);
        renderPagination();
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏:', err);
    }
}

// –ó–∞–ø—É—Å–∫
fetchGalleryData();

const itemsPerPage = 18;
const pagesPerGroup = 5;
let currentPage = 1;

function renderGallery(page) {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageItems = objects.slice(start, end);

    pageItems.forEach((obj) => {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-md-3 col-lg-2";

        col.innerHTML = `
  <div class="card h-100">
    <img src="data:image/png;base64,${obj.img}" class="card-img-top" alt="${obj.title}" />
    <div class="card-body text-center">
      <h6 class="card-title">${obj.title}</h6>
      <button class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
    </div>
  </div>
`;
        gallery.appendChild(col);
    });
}

function renderPagination() {
    const totalPages = Math.ceil(objects.length / itemsPerPage);
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = "";

    const groupIndex = Math.floor((currentPage - 1) / pagesPerGroup);
    const start = groupIndex * pagesPerGroup + 1;
    const end = Math.min(start + pagesPerGroup - 1, totalPages);

    // << –ö –Ω–∞—á–∞–ª—É
    pagination.appendChild(createPageItem("<<", 1, currentPage === 1));

    // < –ù–∞–∑–∞–¥ –Ω–∞ 5
    pagination.appendChild(createPageItem("<", start - 1, start === 1));

    // –°—Ç—Ä–∞–Ω–∏—Ü—ã –≥—Ä—É–ø–ø—ã
    for (let i = start; i <= end; i++) {
        const li = createPageItem(i, i, false, i === currentPage);
        pagination.appendChild(li);
    }

    // > –í–ø–µ—Ä–µ–¥ –Ω–∞ 5
    pagination.appendChild(createPageItem(">", end + 1, end === totalPages));

    // >> –í –∫–æ–Ω–µ—Ü
    pagination.appendChild(createPageItem(">>", totalPages, currentPage === totalPages));
}

function createPageItem(label, page, disabled, active = false) {
    const li = document.createElement("li");
    li.className = `page-item ${disabled ? "disabled" : ""}`;
    //   li.style = 'margin: 30px';
    const btn = document.createElement("button");
    btn.className = `page-link page-btn ${active ? "active" : ""}`;

    btn.textContent = label;
    btn.onclick = () => {
        if (!disabled) {
            currentPage = page;
            renderGallery(currentPage);
            renderPagination();
        }
    };
    li.appendChild(btn);
    return li;
}

// –ü–µ—Ä–≤–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
renderGallery(currentPage);
renderPagination();

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —á—Ç–æ–±—ã –±—ã–ª –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É(18 –æ–±—ä–µ–∫—Ç–æ–≤),
–Ω–æ –º–µ–Ω—é –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–æ—Å—å –∏—Å—Ö–æ–¥—è –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö,
–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É, –±—ã–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ 18 –æ–±—ä–µ–∫—Ç–æ–≤. 

–ò–¥–µ—è
–ö–ª–∏–µ–Ω—Ç —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤.

–ó–∞—Ç–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ limit –∏ offset.

–®–∞–≥–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (gallery.js)
1. –£–¥–∞–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ objects
–û–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω ‚Äî –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

2. –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é totalItems

let totalItems = 0;
const itemsPerPage = 18;
const pagesPerGroup = 5;
let currentPage = 1;

3. –ü–æ–ª—É—á–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤

async function fetchTotalCount() {
    try {
        const res = await fetch('/gallery/count');
        const data = await res.json();
        totalItems = data.total;
        renderPagination();
        fetchGalleryPage(currentPage);
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤:', err);
    }
}

4. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

async function fetchGalleryPage(page) {
    try {
        const offset = (page - 1) * itemsPerPage;
        const res = await fetch(`/gallery?page=${page}&limit=${itemsPerPage}`);
        const data = await res.json();

        const pageObjects = data.map((item, i) => ({
            title: item.title || `–û–±—ä–µ–∫—Ç ${offset + i + 1}`,
            img: item.foto || `https://images.unsplash.com/photo-1543466835-00a7907e9de1`,
        }));

        renderGallery(pageObjects);
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥–∞–ª–µ—Ä–µ–∏:', err);
    }
}

–û–±–Ω–æ–≤–ª—è–µ–º renderGallery –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º

function renderGallery(pageItems) {
    const gallery = document ...

1. Route to get total count
// GET /gallery/count
app.get('/gallery/count', async (req, res) => {
  try {
    const total = await GalleryModel.countDocuments(); // MongoDB
    res.json({ total });
  } catch (err) {
    console.error('Error fetching total count:', err);
    res.status(500).json({ error: 'Server error' });
  }
});

2.Route to get paginated data
// GET /gallery?page=1&limit=18
app.get('/gallery', async (req, res) => {
  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 18;
  const skip = (page - 1) * limit;

  try {
    const items = await GalleryModel.find().skip(skip).limit(limit);
    res.json(items);
  } catch (err) {
    console.error('Error fetching gallery page:', err);
    res.status(500).json({ error: 'Server error' });
  }
});


–ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑¬†–±–∞–∑—ã 
const Collection = require('../models/collectionModel.js');

const getallcollection = (req, res) => {
    const title = 'My collection';
    Collection
        .find({})
        .sort({ createdAt: -1 })
        .then((collection) => res.json(collection))
        .catch((error) => handleError(res, error));
};

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ç–∞–∫–æ–≥–æ-–∂–µ –≤–∏–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –±–∞–∑–µ

–ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ  –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑¬†–±–∞–∑—ã 
const Collection = require('../models/collectionModel.js');

const getgallerypage = (req, res) => {

    const page = parseInt(req.query.page) || 1;
    const limit = parseInt(req.query.limit) || 18;
    const skip = (page - 1) * limit;
    console.log('^^^^^^^^^', page, limit, skip);
    Collection
        .find.skip(skip).limit(limit)
        .then((items) => res.json(items))
        .catch((error) => handleError(res, error));
};

–∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –µ–µ —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ–±—ã –≤—ã–±–∏—Ä–∞–ª–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ö–µ–∫—Ç–æ–≤
–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ page, limit, skip


<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

  <body class="home">


–ï—Å—Ç—å —Ñ–æ—Ä–º–∞
    <%- include('./partials/nav.ejs') %>

      <div class="position-relative">
        <div class="position-absolute top-50 start-50 translate-middle">

          <form id="addcollection" method="post" action="api/addcollection" enctype="multipart/form-data">
            <div class="mb-3">
              <label class="form-label">title
                <input type="text" name="title" id="title" class="form-control">
              </label>
            </div>


            <textarea name="content" id="content" rows="7" cols="40">
                          This is the default comment...  
            </textarea>


            <div class="input-group">
              <label class="form-label">Foto <br>
                <input type="file" name="foto" id="foto" class="form-control-file mb-3"
                  aria-describedby="inputGroupFileAddon03" aria-label="Upload" accept="image/*">
              </label>
            </div>


            <div class="input-group">
              <label class="form-label">Foto1 <br>
                <input type="file" name="foto1" id="foto1" class="form-control-file mb-3"
                  aria-describedby="inputGroupFileAddon03" aria-label="Upload" accept="image/*">
              </label>
            </div>

            <div class="input-group">
              <label class="form-label">Foto2 <br>
                <input type="file" name="foto2" id="foto2" class="form-control-file mb-3"
                  aria-describedby="inputGroupFileAddon03" aria-label="Upload" accept="image/*">
              </label>
            </div>


            <div>
              <input type="submit" value="Submit" class="btn btn-primary">
            </div>
          </form>


        </div>
      </div>


      <%- include('./partials/footer.ejs') %>
        <script src="/js/userfoto.js"></script>
  </body>

</html>

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —á—Ç–æ–±—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∏–¥ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
–∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á—Ç–æ–±—ã —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ
–∏ –∑–∞–ø–∏—Å–∞–Ω –≤ –ø–æ–ª–µ user —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

const addcollection = async (req, res) => {
    const base64Files = {};

    ['foto', 'foto1', 'foto2'].forEach(field => {
        if (req.files[field]) {
            const fileBuffer = req.files[field][0].buffer;
            const base64String = fileBuffer.toString('base64');
            base64Files[field] = base64String;
        }
    });
    const { title, content, cuser } = req.body;
    let str64;
    if (base64Files.foto) { str64 = base64Files.foto }
    else { str64 = "" };
    const bodystr641 = str64;


    if (base64Files.foto1) { str64 = base64Files.foto1 }
    else { str64 = "" };
    const bodystr642 = str64;


    if (base64Files.foto2) { str64 = base64Files.foto2 }
    else { str64 = "" };
    const bodystr643 = str64;

    Collection
    const collection = new Collection({ title, content, foto: bodystr641, foto1: bodystr642, foto2: bodystr643 });
    collection
        .save()
        .then((collection) => res.render(createPath('collection'), { collection }))
        .catch(() => res.render(createPath('error')));
}

–∞–Ω–µ–Ω–∏–µ userId –≤ localStorage
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –≤—ã —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞:

js
localStorage.setItem('userId', '1234567890abcdef'); // –ø—Ä–∏–º–µ—Ä
‚úèÔ∏è 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –≤ —Ñ–æ—Ä–º—É
–í HTML-—Ñ–æ—Ä–º—É –¥–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ localStorage:

html
<input type="hidden" name="cuser" id="cuser">
‚öôÔ∏è 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—è cuser –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
–î–æ–±–∞–≤—å—Ç–µ JavaScript, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã –≤—Å—Ç–∞–≤–∏—Ç—å userId:

html
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const userId = localStorage.getItem('userId');
    if (userId) {
      document.getElementById('cuser').value = userId;
    }
  });
</script>
üõ†Ô∏è 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏
–¢–µ–ø–µ—Ä—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ cuser –∏–∑ req.body. –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é:

js
const addcollection = async (req, res) => {
  const base64Files = {};

  ['foto', 'foto1', 'foto2'].forEach(field => {
    if (req.files[field]) {
      const fileBuffer = req.files[field][0].buffer;
      const base64String = fileBuffer.toString('base64');
      base64Files[field] = base64String;
    }
  });

  const { title, content, cuser } = req.body;

  // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
  const user = await User.findById(cuser);
  if (!user) {
    return res.status(404).send('User not found');
  }

  const collection = new Collection({
    title,
    content,
    foto: base64Files.foto || "",
    foto1: base64Files.foto1 || "",
    foto2: base64Files.foto2 || "",
    user: user._id // –ü—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  });

  collection
    .save()
    .then((collection) => res.render(createPath('collection'), { collection }))
    .catch(() => res.render(createPath('error')));
};
‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
–í –º–æ–¥–µ–ª–∏ Collection –µ—Å—Ç—å –ø–æ–ª–µ user —Ç–∏–ø–∞ ObjectId, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –º–æ–¥–µ–ª—å—é User:

js
user: {
  type: mongoose.Schema.Types.ObjectId,
  ref: 'User',
  required: true
}

–ü–æ—á–µ–º—É –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ 
        .then((collection) => res.render(createPath('collection'), { collection }))
–≤ —Ñ–∞–π–ª–µ 

<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

  <body class="home">
    <%- include('./partials/nav.ejs') %>

      <div style="margin-top: 50px;">
        <div class="position-absolute top-50 start-50 translate-middle">

          <div class="mb-4" style="text-align: center;">title
            <p>
              <%= collection.title %>
            </p>
          </div>

          <div class="mb-4" style="text-align: center;">

            <p style="text-align: center;">
              content
            </p>
            content
            <textarea rows="8" cols="40">
              <%= collection.content %>
            </textarea>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">foto
              <img src="data:image/png;base64,<%= collection.foto %>" class="img-fluid">
            </div>

            <div class="col-md-4 mb-3">foto1
              <img src="data:image/png;base64,<%= collection.foto1 %>" class="img-fluid">
            </div>

            <div class="col-md-4 mb-3">foto2
              <img src="data:image/png;base64,<%= collection.foto2 %>" class="img-fluid">
            </div>
          </div>

        </div>
      </div>

      <%- include('./partials/footer.ejs') %>

  </body>

</html>

–Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∏–ª—å 

.navbar .nav-link {
  color: white !important; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  /* font-weight: bold; */
  /* font-weight: 900; */
  font-size: x-large;
}

.navbar-brand {
  font-weight: 700;
  color: #ecf0f1 !important;
}

–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∏–ª—å –ë—É–¥—Å—Ç—Ä–∞–ø–∞